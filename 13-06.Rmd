---
title: "2 scénarios mortalité"
author: "Antoine"
date: \`r format(Sys.Date(), "%m %d,%Y")`\
output:
  slidy_presentation: default
---

```{r setup, include=FALSE}
rm(list=ls())

# packages
library(tidyverse)
library(DescTools)
library(tis)


# options
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.height = 18, fig.width = 25, fig.align = "center")
```

```{r multiplot function}

# multiplot function : several ggplot on the same page

multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}
```

## Expérience

- Foraging-pattern : + intelligent

- infection rate = à chaque tick, on infecte un % constant du stock inital de crops

- 2 scenarios d'agregation : faible (1) VS forte (5) des éléments semi-naturels

- 2 scénarios de mortalité : faible (0.01) VS forte (0.08)


Rq : un patch crop ne peut pas être infecté 2x

- 1 simulation pour chaque config.
- 5 years pour chaque simulation, ce qui permet à priori d'atteindre l'équilibre
- proportion 0-10-90 % des patchs sont des éléments semi-naturels
- nb. init. : 0/10
- les prédateurs sortent tôt des SNH : date de sortie cste à 7 j.

Quel effet de la proportion sur les différents indicateurs ?


```{r working directory}
## wd
data_path <- "data/data1806"
```

```{r load data dyn.}
## dyn
filename.dyn <- list.files(data_path, 
                           pattern="^tick-[0-9]{1,4}-[0-9]{1,2}-[0-9]{1}-[0-9]{1,4}-[0-9]{1,4}-[0-9]{1,4}-[0-9]{1,4}.txt")

column.names.dyn <- c(
  # init.params
  "infection.rate",
  "proportion",
  "agregation",
  "mortality",
  "nb.init",
  "proba.birth",
  # time
  "year",
  "date",
  # outputs
  "nb.visited.patches",
  "dyn.never.inf",
  "dyn.inf",
  "dyn.inf.non.occ",
  "dyn.inf.occ.ad",
  "dyn.inf.occ.juv",
  "dyn.inf.occ",
  "dyn.cured",
  "dyn.adults",
  "dyn.juv")

## load -> data.dyn contient toutes les données, y compris le control (nb.init 0 / proportion 0)

data.dyn <- tibble(filename.dyn) %>% 
  # load whole data
  mutate(file_contents = map(filename.dyn, ~ read_delim(file.path(data_path, .), delim = " ", col_names = column.names.dyn))) %>% 
  unnest()
```

```{r data.dyn.mean}

# mean sur 10 simulations pour toutes les var. relatives à la dyn. des pests
# -> en % pour normaliser par rapport au nb de crop patches

data.dyn.mean <- data.dyn %>% 
  # average : mean
  group_by(infection.rate, proportion, agregation, mortality, nb.init, year, date) %>% 
  mutate(mean.inf = mean(dyn.inf)) %>% 
  mutate(mean.never.inf = mean(dyn.never.inf)) %>% 
  mutate(mean.inf.non.occ = mean(dyn.inf.non.occ)) %>% 
  mutate(mean.inf.occ = mean(dyn.inf.occ)) %>% 
  mutate(mean.cured = mean(dyn.cured)) %>% 
  # adults
  mutate(mean.adults = mean(dyn.adults)) %>% 
  distinct(infection.rate, proportion, agregation, mortality, nb.init, year, date, .keep_all = TRUE) %>% 
  ungroup() %>% 
  # select data we are interested in
  select(- filename.dyn, - proba.birth, - nb.visited.patches) %>%   
  # tot crop patches in the landscape
  mutate(stock.crops = 1089 - floor(1089*proportion/100)) %>% 
  # % of landscape infected (fl = fill level)
  mutate(fl.inf = mean.inf*100/stock.crops) %>%
  # % of landscape never infected
  mutate(fl.never.inf = mean.never.inf*100/stock.crops) %>%
  # % of landscape infected patches without predators (adults / juveniles)
  mutate(fl.non.occ = mean.inf.non.occ*100/stock.crops) %>%
  # % of landscape infected crop patches with predators (adults / juveniles)
  mutate(fl.occ = mean.inf.occ*100/stock.crops) %>%
  # % of landscape infected ad then cured
  mutate(fl.cured = mean.cured*100/stock.crops) %>%
  # numeric -> factor (for ggplot)
  mutate(infection.rate = factor(infection.rate)) %>% 
  mutate(proportion = factor(proportion))
```

```{r load data distribution time.for.crop.loss}
## dyn
filename.pred.event <- list.files(data_path, 
                           pattern="^pred-event-[0-9]{1,4}-[0-9]{1,2}-[0-9]{1}-[0-9]{1,4}-[0-9]{1,4}-[0-9]{1,4}-[0-9]{1,4}.txt")

column.names.tforcroploss <- c(
  # par.
  "proportion",
  "agregation", 
  "infection.rate",
  "mortality",
  "nb.init",
  # time
  "year", 
  "date",
  # outputs
  "event",
  "pxcor",
  "pycor",
  "infection.date",
  "t.for.crop.loss")


## load 
data.tforcroploss <- tibble(filename.pred.event) %>% 
  mutate(file_contents = map(filename.pred.event, ~ read_delim(file.path(data_path, .), delim = " ", col_names = column.names.tforcroploss))) %>% 
  unnest()
```

```{r mean time.for.crop.loss}
data.tforcroploss.mean <- data.tforcroploss %>%
  select(filename.pred.event, infection.rate, proportion, agregation, mortality, nb.init, year, t.for.crop.loss) %>%
  # total occurences pour toutes les répétitions
  count(infection.rate, proportion, agregation, mortality, nb.init, year, t.for.crop.loss) %>% 
  # mean : on divise le total d'occurences par le nb. de répétitions (pour une même config.)
  mutate(n = n / (nrow(data.tforcroploss %>%
                        select(filename.pred.event, infection.rate, proportion, agregation, mortality, nb.init) %>% 
                        unique()) / nrow(data.tforcroploss %>%
                                           select(infection.rate, proportion, agregation, mortality, nb.init) %>% 
                                           unique()))) 
```


```{r load data crop.loss landscape}
## dyn
filename.end.season <- list.files(data_path, 
                                  pattern="^end-season-[0-9]{1,4}-[0-9]{1,2}-[0-9]{1}-[0-9]{1,4}-[0-9]{1,4}-[0-9]{1,4}-[0-9]{1,4}.txt")

column.names.end.season <- c(
  # par.
  "infection.rate",
  "proportion",
  "agregation", 
  "mortality",
  "nb.init",
  # time
  "year", 
  # outputs
  "lsc.tot.crop.loss",
  "total.nb.foraging.movements",
  "total.nb.foraging.movements-in-crops",
  "total.nb.foraging.movements-in-SNH")

## load 

data.end.season <- tibble(filename.end.season) %>% 
  mutate(file_contents = map(filename.end.season, ~ read_delim(file.path(data_path, .), delim = " ", col_names = column.names.end.season))) %>% 
  unnest()
```

```{r mean data crop.loss landscape}
# on a 10 simulations par cnfig -> mean(10 values of crop.loss)
data.end.season.mean <- data.end.season %>% 
  group_by(infection.rate, proportion, agregation, mortality, nb.init, year) %>% 
  mutate(mean.lsc.tot.crop.loss = mean(lsc.tot.crop.loss)) %>% 
  select(-filename.end.season) %>% 
  distinct()
```


```{r load data for distribution of crop.loss values for crop patches}
## dyn
filename.spatial <- list.files(data_path, 
                                  pattern="^spatial-[0-9]{1,4}-[0-9]{1,2}-[0-9]{1}-[0-9]{1,4}-[0-9]{1,4}-[0-9]{1,4}-[0-9]{1,4}.txt")

column.names.spatial <- c(
  # par.
  "proportion",
  "agregation", 
  "infection.rate",
  "mortality",
  "nb.init",
  # time
  "year", 
  "date",
  # spatial
  "pxcor",
  "pycor",
  "land.cover",
  # outputs
  "nb.visits",
  "nb.cycles",
  "time.for.crop.loss",
  "tot.crop.loss")

## load 
data.spatial <- tibble(filename.spatial) %>% 
  mutate(file_contents = map(filename.spatial, ~ read_delim(file.path(data_path, .), delim = " ", col_names = column.names.spatial))) %>% 
  unnest()
```

```{r mean data distribution of crop.loss values for crop patches}
data.spatial.mean <- data.spatial %>% 
  # filter
  filter(land.cover == 1) %>% 
  # mean value of total crop loss for one patch (10 simulations)
  group_by(infection.rate, proportion, agregation, mortality, nb.init, year, pxcor, pycor) %>% 
  summarize(mean.tot.crop.loss = mean(tot.crop.loss)) %>% 
  ungroup()
```

## Description du pattern d'infection des crops par les pests

- en haut : quel % de crops parmi tous les crops a finalement été infecté lors de l'année ?
- en bas : à quelle date l'infection parvient-elle à infecter l'ensemble des crops ?

```{r pattern inf}
plot1 <- tibble(proportion = rep(sort(unique(as.numeric(as.character(data.dyn.mean$proportion)))),length(unique(as.numeric(as.character(data.dyn.mean$infection.rate))))),
       stock.crops = round(1089 -(1089 * proportion/100),0),
       inf.rate = rep(sort(unique(as.numeric(as.character(data.dyn.mean$infection.rate)))), each = length(unique(as.numeric(as.character(data.dyn.mean$proportion))))),
       tot.crops.inf = ifelse ((150 * round(inf.rate/100*1089)) < stock.crops, (150 * round(inf.rate/100*1089)), stock.crops),
       fl = tot.crops.inf/stock.crops*100) %>% 
  # si inf.rate > 0.6% il y a saturation qque soit la proportion
  #filter(inf.rate %in% seq(0.1,0.6,0.1)) %>% 
  ggplot() +
  geom_point(mapping = aes(x = as.factor (proportion), y = fl)) +
  scale_y_continuous(breaks=c(100)) +
  xlab("Proportion") +
  ylab("% total du stock de crops finalement infecté") +
  facet_grid(inf.rate ~ ., labeller = label_both) +
  ggtitle("Pourcentage du stock de crops finalement infecté")

plot2 <- tibble(proportion = rep(sort(unique(as.numeric(as.character(data.dyn.mean$proportion)))),length(unique(as.numeric(as.character(data.dyn.mean$infection.rate))))),
       stock.crops = round(1089 -(1089 * proportion/100),0),
       inf.rate = rep(sort(unique(as.numeric(as.character(data.dyn.mean$infection.rate)))), each = length(unique(as.numeric(as.character(data.dyn.mean$proportion))))),
       tick.tot.crops.inf = round(stock.crops / round(inf.rate/100*stock.crops))) %>% 
  # si inf.rate > 0.6% il y a saturation qque soit la proportion
  #filter(inf.rate %in% seq(0.1,0.6,0.1)) %>% 
  ggplot() +
  geom_point(mapping = aes(x = as.factor (proportion), y = tick.tot.crops.inf)) +
  xlab("Proportion") +
  ylab("Date") +
  scale_y_continuous(breaks= c(0,150,900))+ 
  facet_grid(inf.rate ~ ., labeller = label_both) +
  ggtitle("Date à laquelle tous les crops seraient théoriquement infectés")

multiplot(plot1, plot2, cols = 2)
```

## Dynamique de l'occupation des crops par les pests

```{r dyn inf With VS Without preds}
plot1 <- data.dyn.mean %>% 
  # control
  filter(nb.init == 0) %>% 
  filter(year == 5) %>%
  #scenario agrégation forte
  filter(agregation == 5) %>%
  #scenario mortalité faible
  filter(mortality == 0.01) %>% 
  # plot
  ggplot() +
  # control
  geom_point(mapping = aes(x = date, y = fl.inf, colour = "Sans prédateurs"),
             size = 0.5) + 
  # data (= with pred)
  ## inf.
  geom_point(data = data.dyn.mean %>% 
               # même filtre que control
               filter(year == 5) %>%
               filter(nb.init == 10) %>% 
               # scénario agrégation forte
               filter(agregation == 5) %>%
               # scénario mortalité faible
               filter(mortality == 0.01) %>% 
               # filter proportion 0 pour éviter le doublon de courbes
               filter(proportion != 0),
             mapping = aes(x = date , y = fl.inf, colour = "Avec prédateurs"),
             size = 0.5) + 
  ylab("Pourcentage de crops statut infecté / stock de crops") +
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation forte : Dynamique du nb. crops infectés \nYear = 5, nb init pred = 10")

plot2 <- data.dyn.mean %>% 
  # control
  filter(nb.init == 0) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>% 
  # plot
  ggplot() +
  # control
  geom_point(mapping = aes(x = date, y = fl.inf, colour = "Sans prédateurs"),
             size = 0.5) + 
  # data (= with pred)
  ## inf.
  geom_point(data = data.dyn.mean %>% 
               # même filtre que control
               filter(year == 5) %>%
               filter(nb.init == 10) %>% 
               # scénario agrégation faible
               filter(agregation == 1) %>%
               # scénario mortalité faible
               filter(mortality == 0.01) %>% 
               # filter proportion 0 pour éviter le doublon de courbes
               filter(proportion != 0),
             mapping = aes(x = date , y = fl.inf, colour = "Avec prédateurs"),
             size = 0.5) + 
  ylab("Pourcentage de crops statut infecté / stock de crops") +
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation faible : Dynamique du nb. crops infectés \nYear = 5, nb init pred = 10")

plot3 <- data.dyn.mean %>% 
  # control
  filter(nb.init == 0) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>% 
  # plot
  ggplot() +
  # control
  geom_point(mapping = aes(x = date, y = fl.inf, colour = "Sans prédateurs"),
             size = 0.5) + 
  # data (= with pred)
  ## inf.
  geom_point(data = data.dyn.mean %>% 
               # même filtre que control
               filter(year == 5) %>%
               filter(nb.init == 10) %>% 
               # scénario agrégation forte
               filter(agregation == 5) %>%
               # scénario mortalité forte
               filter(mortality == 0.08) %>% 
               # filter proportion 0 pour éviter le doublon de courbes
               filter(proportion != 0),
             mapping = aes(x = date , y = fl.inf, colour = "Avec prédateurs"),
             size = 0.5) + 
  ylab("Pourcentage de crops statut infecté / stock de crops") +
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation forte : Dynamique du nb. crops infectés \n Year = 5, nb init pred = 10")

plot4 <- data.dyn.mean %>% 
  # control
  filter(nb.init == 0) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>% 
  # plot
  ggplot() +
  # control
  geom_point(mapping = aes(x = date, y = fl.inf, colour = "Sans prédateurs"),
             size = 0.5) + 
  # data (= with pred)
  ## inf.
  geom_point(data = data.dyn.mean %>% 
               # même filtre que control
               filter(year == 5) %>%
               filter(nb.init == 10) %>% 
               # scénario agrégation faible
               filter(agregation == 1) %>%
               # scénario mortalité forte
               filter(mortality == 0.08) %>% 
               # filter proportion 0 pour éviter le doublon de courbes
               filter(proportion != 0),
             mapping = aes(x = date , y = fl.inf, colour = "Avec prédateurs"),
             size = 0.5) + 
  ylab("Pourcentage de crops statut infecté / stock de crops") +
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation faible : Dynamique du nb. crops infectés \nYear = 5, nb init pred = 10")

multiplot(plot1, plot2, plot3, plot4, cols = 2)
```

## Audpc : dynamique du % de crops occupés par des pests

```{r comparaison audpc inf}

plot1 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>% 
  # plot
  # filter proportion for readability
  filter(proportion %in% seq(10,50,10)) %>% 
  # compute audpc for fl.inf.
  select(infection.rate, proportion, mortality, date, fl.inf) %>% 
  group_by(infection.rate, proportion, mortality) %>% 
  mutate(audpc.inf = sum(lintegrate(date, fl.inf, xint=date))) %>%
  ungroup() %>% 
  select(-fl.inf) %>% 
  distinct() %>% 
  # plot according to proportion
  ggplot() +
  geom_point(aes(x = infection.rate, y = audpc.inf, colour = "Avec prédateurs")) +
  geom_point(data = data.dyn.mean %>%
               filter(year == 5) %>%
               # scenario agrégation forte
               filter(agregation == 5) %>%
               # scenario mortalité faible
               filter(mortality == 0.01) %>% 
               # plot
               # filter control
               filter(nb.init == 0) %>%
               # filter proportion for readability
               filter(proportion %in% seq(10,50,10)) %>% 
               # compute audpc for inf.
               select(infection.rate, proportion, mortality, date, fl.inf) %>% 
               group_by(infection.rate, proportion, mortality) %>% 
               mutate(audpc.inf = sum(lintegrate(date, fl.inf, xint=date))) %>%
               ungroup() %>% 
               select(-fl.inf) %>% 
               distinct(),
             mapping = aes(x = infection.rate, y = audpc.inf, colour = "Sans prédateurs")) +
  facet_grid(proportion ~ ., labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation forte : comparaison des audpc (% de crops infectés) \nYear = 5, nb init pred = 10")


plot2 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>% 
  # plot
  # filter proportion for readability
  filter(proportion %in% seq(10,50,10)) %>% 
  # compute audpc for fl.inf.
  select(infection.rate, proportion, mortality, date, fl.inf) %>% 
  group_by(infection.rate, proportion, mortality) %>% 
  mutate(audpc.inf = sum(lintegrate(date, fl.inf, xint=date))) %>%
  ungroup() %>% 
  select(-fl.inf) %>% 
  distinct() %>% 
  # plot according to proportion
  ggplot() +
  geom_point(aes(x = infection.rate, y = audpc.inf, colour = "Avec prédateurs")) +
  geom_point(data = data.dyn.mean %>%
               filter(year == 5) %>%
               # scenario agrégation faible
               filter(agregation == 1) %>%
               # scenario mortalité faible
               filter(mortality == 0.01) %>% 
               # plot
               # filter control
               filter(nb.init == 0) %>%
               # filter proportion for readability
               filter(proportion %in% seq(10,50,10)) %>% 
               # compute audpc for inf.
               select(infection.rate, proportion, mortality, date, fl.inf) %>% 
               group_by(infection.rate, proportion, mortality) %>% 
               mutate(audpc.inf = sum(lintegrate(date, fl.inf, xint=date))) %>%
               ungroup() %>% 
               select(-fl.inf) %>% 
               distinct(),
             mapping = aes(x = infection.rate, y = audpc.inf, colour = "Sans prédateurs")) +
  facet_grid(proportion ~ ., labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation faible : comparaison des audpc (% de crops infectés) \nYear = 5, nb init pred = 10")

plot3 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>% 
  # plot
  # filter proportion for readability
  filter(proportion %in% seq(10,50,10)) %>% 
  # compute audpc for fl.inf.
  select(infection.rate, proportion, mortality, date, fl.inf) %>% 
  group_by(infection.rate, proportion, mortality) %>% 
  mutate(audpc.inf = sum(lintegrate(date, fl.inf, xint=date))) %>%
  ungroup() %>% 
  select(-fl.inf) %>% 
  distinct() %>% 
  # plot according to proportion
  ggplot() +
  geom_point(aes(x = infection.rate, y = audpc.inf, colour = "Avec prédateurs")) +
  geom_point(data = data.dyn.mean %>%
               filter(year == 5) %>%
               # scenario agrégation forte
               filter(agregation == 5) %>%
               # scenario mortalité forte
               filter(mortality == 0.08) %>% 
               # plot
               # filter control
               filter(nb.init == 0) %>%
               # filter proportion for readability
               filter(proportion %in% seq(10,50,10)) %>% 
               # compute audpc for inf.
               select(infection.rate, proportion, mortality, date, fl.inf) %>% 
               group_by(infection.rate, proportion, mortality) %>% 
               mutate(audpc.inf = sum(lintegrate(date, fl.inf, xint=date))) %>%
               ungroup() %>% 
               select(-fl.inf) %>% 
               distinct(),
             mapping = aes(x = infection.rate, y = audpc.inf, colour = "Sans prédateurs")) +
  facet_grid(proportion ~ ., labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation forte : comparaison des audpc (% de crops infectés) \nYear = 5, nb init pred = 10")

plot4 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>% 
  # plot
  # filter proportion for readability
  filter(proportion %in% seq(10,50,10)) %>% 
  # compute audpc for fl.inf.
  select(infection.rate, proportion, mortality, date, fl.inf) %>% 
  group_by(infection.rate, proportion, mortality) %>% 
  mutate(audpc.inf = sum(lintegrate(date, fl.inf, xint=date))) %>%
  ungroup() %>% 
  select(-fl.inf) %>% 
  distinct() %>% 
  # plot according to proportion
  ggplot() +
  geom_point(aes(x = infection.rate, y = audpc.inf, colour = "Avec prédateurs")) +
  geom_point(data = data.dyn.mean %>%
               filter(year == 5) %>%
               # scenario agrégation faible
               filter(agregation == 1) %>%
               # scenario mortalité forte
               filter(mortality == 0.08) %>% 
               # plot
               # filter control
               filter(nb.init == 0) %>%
               # filter proportion for readability
               filter(proportion %in% seq(10,50,10)) %>% 
               # compute audpc for inf.
               select(infection.rate, proportion, mortality, date, fl.inf) %>% 
               group_by(infection.rate, proportion, mortality) %>% 
               mutate(audpc.inf = sum(lintegrate(date, fl.inf, xint=date))) %>%
               ungroup() %>% 
               select(-fl.inf) %>% 
               distinct(),
             mapping = aes(x = infection.rate, y = audpc.inf, colour = "Sans prédateurs")) +
  facet_grid(proportion ~ ., labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation faible : comparaison des audpc (% de crops infectés) \nYear = 5, nb init pred = 10")


multiplot(plot1,plot2,plot3,plot4, cols = 2)
```


## Dynamiques des différents statuts des crops

```{r decoupage inf}
plot1 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>% 
  # plot
  ggplot() +
  geom_point(mapping = aes(x = date, y = fl.never.inf, colour = "Crops jamais infectés"),
             size = 0.5) + 
  geom_point(mapping = aes(x = date, y = fl.non.occ, colour = "Crops infectés sans préd."),
             size = 0.5) + 
  geom_point(mapping = aes(x = date, y = fl.occ, colour = "Crops infectés avec préd."),
             size = 0.5) + 
  geom_point(mapping = aes(x = date, y = fl.cured, colour = "Crops guéris"),
             size = 0.5) + 
  ylab("Pourcentage de crops infectés / stock de crops") +
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation forte : Dynamique de l'infection (%) \nYear = 5, nb init pred = 10")

plot2 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>% 
  # plot
  ggplot() +
  geom_point(mapping = aes(x = date, y = fl.never.inf, colour = "Crops jamais infectés"),
             size = 0.5) + 
  geom_point(mapping = aes(x = date, y = fl.non.occ, colour = "Crops infectés sans préd."),
             size = 0.5) + 
  geom_point(mapping = aes(x = date, y = fl.occ, colour = "Crops infectés avec préd."),
             size = 0.5) + 
  geom_point(mapping = aes(x = date, y = fl.cured, colour = "Crops guéris"),
             size = 0.5) + 
  ylab("Pourcentage de crops infectés / stock de crops") +
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation faible : Dynamique de l'infection (%) \nYear = 5, nb init pred = 10")

plot3 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>% 
  # plot
  ggplot() +
  geom_point(mapping = aes(x = date, y = fl.never.inf, colour = "Crops jamais infectés"),
             size = 0.5) + 
  geom_point(mapping = aes(x = date, y = fl.non.occ, colour = "Crops infectés sans préd."),
             size = 0.5) + 
  geom_point(mapping = aes(x = date, y = fl.occ, colour = "Crops infectés avec préd."),
             size = 0.5) + 
  geom_point(mapping = aes(x = date, y = fl.cured, colour = "Crops guéris"),
             size = 0.5) + 
  ylab("Pourcentage de crops infectés / stock de crops") +
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation forte : Dynamique de l'infection (%) \nYear = 5, nb init pred = 10")

plot4 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>% 
  # plot
  ggplot() +
  geom_point(mapping = aes(x = date, y = fl.never.inf, colour = "Crops jamais infectés"),
             size = 0.5) + 
  geom_point(mapping = aes(x = date, y = fl.non.occ, colour = "Crops infectés sans préd."),
             size = 0.5) + 
  geom_point(mapping = aes(x = date, y = fl.occ, colour = "Crops infectés avec préd."),
             size = 0.5) + 
  geom_point(mapping = aes(x = date, y = fl.cured, colour = "Crops guéris"),
             size = 0.5) + 
  ylab("Pourcentage de crops infectés / stock de crops") +
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation faible : Dynamique de l'infection (%) \nYear = 5, nb init pred = 10")

multiplot(plot1, plot2,plot3,plot4, cols = 2)
```



## Dynamiques comparées : crops occupés (%) VS nb. de prédateurs adultes

```{r inf VS adults}
plot1 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>% 
  # plot
  ggplot() +
  ## inf. non.occ
  geom_point(mapping = aes(x = date, y = fl.inf, colour = "% crops statut infecté"),
             size = 0.5) + 
  # dyn. adults
  geom_line(mapping = aes(x = date, y = mean.adults * 100 / max(mean.adults), colour = "Nb. preds. adultes"),
             size = 0.5) + 
  # y = double axe -> à gauche : taux de remplissage / à droite : dyn. pests et adults
  scale_y_continuous(name = expression("% crops infectés"), #left axis
                     sec.axis = sec_axis(~ . * (max(data.dyn.mean$mean.adults)+10) / 100 , name = "Nb. pred. adults", breaks = c(300,600,900,1089)), # right axis
                     limits = c(0, 100)) +
  # facets
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation forte : Dynamiques de l'infection (%) & des preds. adultes (nb.) \nYear = 5, nb init pred = 10")

plot2 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>% 
  # plot
  ggplot() +
  ## inf. non.occ
  geom_point(mapping = aes(x = date, y = fl.inf, colour = "% crops statut infecté"),
             size = 0.5) + 
  # dyn. adults
  geom_line(mapping = aes(x = date, y = mean.adults * 100 / max(mean.adults), colour = "Nb. preds. adultes"),
             size = 0.5) + 
  # y = double axe -> à gauche : taux de remplissage / à droite : dyn. pests et adults
  scale_y_continuous(name = expression("% crops infectés"), #left axis
                     sec.axis = sec_axis(~ . * (max(data.dyn.mean$mean.adults)+10) / 100 , name = "Nb. pred. adults", breaks = c(300,600,900,1089)), # right axis
                     limits = c(0, 100)) +
  # facets
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation faible : Dynamiques de l'infection (%) & des preds. adultes (nb.) \nYear = 5, nb init pred = 10")

plot3 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>% 
  # plot
  ggplot() +
  ## inf. non.occ
  geom_point(mapping = aes(x = date, y = fl.inf, colour = "% crops statut infecté"),
             size = 0.5) + 
  # dyn. adults
  geom_line(mapping = aes(x = date, y = mean.adults * 100 / max(mean.adults), colour = "Nb. preds. adultes"),
             size = 0.5) + 
  # y = double axe -> à gauche : taux de remplissage / à droite : dyn. pests et adults
  scale_y_continuous(name = expression("% crops infectés"), #left axis
                     sec.axis = sec_axis(~ . * (max(data.dyn.mean$mean.adults)+10) / 100 , name = "Nb. pred. adults", breaks = c(300,600,900,1089)), # right axis
                     limits = c(0, 100)) +
  # facets
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation forte : Dynamiques de l'infection (%) & des preds. adultes (nb.) \nYear = 5, nb init pred = 10")

plot4 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>% 
  # plot
  ggplot() +
  ## inf. non.occ
  geom_point(mapping = aes(x = date, y = fl.inf, colour = "% crops statut infecté"),
             size = 0.5) + 
  # dyn. adults
  geom_line(mapping = aes(x = date, y = mean.adults * 100 / max(mean.adults), colour = "Nb. preds. adultes"),
             size = 0.5) + 
  # y = double axe -> à gauche : taux de remplissage / à droite : dyn. pests et adults
  scale_y_continuous(name = expression("% crops infectés"), #left axis
                     sec.axis = sec_axis(~ . * (max(data.dyn.mean$mean.adults)+10) / 100 , name = "Nb. pred. adults", breaks = c(300,600,900,1089)), # right axis
                     limits = c(0, 100)) +
  # facets
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation forte : Dynamiques de l'infection (%) & des preds. adultes (nb.) \nYear = 5, nb init pred = 10")

multiplot(plot1, plot2, plot3, plot4, cols = 2)
```

## Dynamiques comparées : crops occupés (nb.) VS nb. prédateurs adultes

```{r absolute inf VS adults}
plot1 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>% 
  # plot
  ggplot() +
  ## inf. non.occ
  geom_point(mapping = aes(x = date, y = mean.inf, colour = "Nb. crops statut infecté"),
             size = 0.5) + 
  # dyn. adults
  geom_line(mapping = aes(x = date, y = mean.adults * 1089 / max(mean.adults), colour = "Nb. preds. adultes"),
             size = 0.5) + 
  # y = double axe -> à gauche : taux de remplissage / à droite : dyn. pests et adults
  scale_y_continuous(name = expression("Nb. crops infectés"), breaks = c(300,600,900,1089), #left axis
                     sec.axis = sec_axis(~ . * (max(data.dyn.mean$mean.adults)+10) / 1089 , name = "Nb. pred. adults", breaks = c(300,600,900,1089))) +
  # facets
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation forte : Dynamiques pests / predators \nYear = 5, nb init pred = 10")

plot2 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>% 
  # plot
  ggplot() +
  ## inf. non.occ
  geom_point(mapping = aes(x = date, y = mean.inf, colour = "Nb. crops statut infecté"),
             size = 0.5) + 
  # dyn. adults
  geom_line(mapping = aes(x = date, y = mean.adults * 1089 / max(mean.adults), colour = "Nb. preds. adultes"),
             size = 0.5) + 
  # y = double axe -> à gauche : taux de remplissage / à droite : dyn. pests et adults
  scale_y_continuous(name = expression("Nb. crops infectés"), breaks = c(300,600,900,1089), #left axis
                     sec.axis = sec_axis(~ . * (max(data.dyn.mean$mean.adults)+10) / 1089 , name = "Nb. pred. adults", breaks = c(300,600,900,1089))) +
  # facets
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation faible : Dynamiques pests / predators \nYear = 5, nb init pred = 10")

plot3 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>% 
  # plot
  ggplot() +
  ## inf. non.occ
  geom_point(mapping = aes(x = date, y = mean.inf, colour = "Nb. crops statut infecté"),
             size = 0.5) + 
  # dyn. adults
  geom_line(mapping = aes(x = date, y = mean.adults * 1089 / max(mean.adults), colour = "Nb. preds. adultes"),
             size = 0.5) + 
  # y = double axe -> à gauche : taux de remplissage / à droite : dyn. pests et adults
  scale_y_continuous(name = expression("Nb. crops infectés"), breaks = c(300,600,900,1089), #left axis
                     sec.axis = sec_axis(~ . * (max(data.dyn.mean$mean.adults)+10) / 1089 , name = "Nb. pred. adults", breaks = c(300,600,900,1089))) +
  # facets
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation forte : Dynamiques pests / predators \nYear = 5, nb init pred = 10")

plot4 <- data.dyn.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>% 
  # plot
  ggplot() +
  ## inf. non.occ
  geom_point(mapping = aes(x = date, y = mean.inf, colour = "Nb. crops statut infecté"),
             size = 0.5) + 
  # dyn. adults
  geom_line(mapping = aes(x = date, y = mean.adults * 1089 / max(mean.adults), colour = "Nb. preds. adultes"),
             size = 0.5) + 
  # y = double axe -> à gauche : taux de remplissage / à droite : dyn. pests et adults
  scale_y_continuous(name = expression("Nb. crops infectés"), breaks = c(300,600,900,1089), #left axis
                     sec.axis = sec_axis(~ . * (max(data.dyn.mean$mean.adults)+10) / 1089 , name = "Nb. pred. adults", breaks = c(300,600,900,1089))) +
  # facets
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation faible : Dynamiques pests / predators \nYear = 5, nb init pred = 10")

multiplot(plot1, plot2, plot3, plot4, cols = 2)
```

## Distributions des temps entre 1) pest arrival 2) adult-predator arrival

```{r tforcroploss}

plot1 <- data.tforcroploss.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>% 
  # plot
  ggplot() +
  geom_bar(aes(x=t.for.crop.loss, y=n), 
           stat = "identity") +  
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  xlab("Time between pest and predator arrivals") +
  ylab("Nb. of occurences") +
  ggtitle("Mortalité faible / Agrégation forte : Distribution des time-for-crop-loss \nYear = 5, nb.init = 10")
  
plot2 <- data.tforcroploss.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>% 
  # plot
  ggplot() +
  geom_bar(aes(x=t.for.crop.loss, y=n), 
           stat = "identity") +  
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  xlab("Time between pest and predator arrivals") +
  ylab("Nb. of occurences") +
  ggtitle("Mortalité faible / Agrégation faible : Distribution des time-for-crop-loss \nYear = 5, nb.init = 10")

plot3 <- data.tforcroploss.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>% 
  # plot
  ggplot() +
  geom_bar(aes(x=t.for.crop.loss, y=n), 
           stat = "identity") +  
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  xlab("Time between pest and predator arrivals") +
  ylab("Nb. of occurences") +
  ggtitle("Mortalité forte / Agrégation forte : Distribution des time-for-crop-loss \nYear = 5, nb.init = 10")
  
plot4 <- data.tforcroploss.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>% 
  # plot
  ggplot() +
  geom_bar(aes(x=t.for.crop.loss, y=n), 
           stat = "identity") +  
  facet_grid(infection.rate ~ proportion, labeller = label_both) +
  xlab("Time between pest and predator arrivals") +
  ylab("Nb. of occurences") +
  ggtitle("Mortalité forte / Agrégation faible : Distribution des time-for-crop-loss \nYear = 5, nb.init = 10")

multiplot(plot1, plot2,plot3,plot4, cols = 2)
```

## Normalisation de la valeur totale de crop-loss par le nb. de crops infectés 

```{r crop.loss per infected crop}
plot1 <- tibble(proportion = rep(sort(unique(as.numeric(as.character(data.dyn.mean$proportion)))),length(unique(as.numeric(as.character(data.dyn.mean$infection.rate))))),
       stock.crops = round(1089 -(1089 * proportion/100),0),
       infection.rate = rep(sort(unique(as.numeric(as.character(data.dyn.mean$infection.rate)))),each = length(unique(as.numeric(as.character(data.dyn.mean$proportion))))),
       tot.crops.inf = ifelse ((150 * round(infection.rate/100*1089)) < stock.crops, (150 * round(infection.rate/100*1089)), stock.crops)) %>% 
  right_join(data.end.season.mean %>% 
               # normalisation crop-loss selon le nb. de crops
               mutate(stock.crops = 1089 - floor(1089*proportion/100)) %>% 
               mutate(norm.mean.lsc.tot.crop.loss = mean.lsc.tot.crop.loss/stock.crops) %>% 
               # filter
               filter(nb.init == 10) %>% 
               filter(year == 5) %>%
               # scenario agrégation forte
               filter(agregation == 5) %>%
               # scenario mortalité faible
               filter(mortality == 0.01) %>%
               ungroup() %>% 
               select(infection.rate, proportion, mean.lsc.tot.crop.loss) %>% 
               distinct(),
             by = c("proportion","infection.rate")) %>% 
  mutate(norm.mean.lsc.tot.crop.loss = mean.lsc.tot.crop.loss / tot.crops.inf) %>% 
  select(infection.rate, proportion, norm.mean.lsc.tot.crop.loss) %>% 
  ggplot() +
  geom_point(mapping = aes(x = as.factor(proportion), y = norm.mean.lsc.tot.crop.loss)) +
  xlab("Proportion SNH") +
  ylab("crop-loss par crop infecté") +
  facet_grid(infection.rate ~ ., labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation forte : crop-loss normalisée (/ pests) \nYear = 5, nb init pred = 10")

plot2 <- tibble(proportion = rep(sort(unique(as.numeric(as.character(data.dyn.mean$proportion)))),length(unique(as.numeric(as.character(data.dyn.mean$infection.rate))))),
       stock.crops = round(1089 -(1089 * proportion/100),0),
       infection.rate = rep(sort(unique(as.numeric(as.character(data.dyn.mean$infection.rate)))),each = length(unique(as.numeric(as.character(data.dyn.mean$proportion))))),
       tot.crops.inf = ifelse ((150 * round(infection.rate/100*1089)) < stock.crops, (150 * round(infection.rate/100*1089)), stock.crops)) %>% 
  right_join(data.end.season.mean %>% 
               # normalisation crop-loss selon le nb. de crops
               mutate(stock.crops = 1089 - floor(1089*proportion/100)) %>% 
               mutate(norm.mean.lsc.tot.crop.loss = mean.lsc.tot.crop.loss/stock.crops) %>% 
               # filter
               filter(nb.init == 10) %>% 
               filter(year == 5) %>%
               # scenario agrégation faible
               filter(agregation == 1) %>%
               # scenario mortalité faible
               filter(mortality == 0.01) %>%
               ungroup() %>% 
               select(infection.rate, proportion, mean.lsc.tot.crop.loss) %>% 
               distinct(),
             by = c("proportion","infection.rate")) %>% 
  mutate(norm.mean.lsc.tot.crop.loss = mean.lsc.tot.crop.loss / tot.crops.inf) %>% 
  select(infection.rate, proportion, norm.mean.lsc.tot.crop.loss) %>% 
  ggplot() +
  geom_point(mapping = aes(x = as.factor(proportion), y = norm.mean.lsc.tot.crop.loss)) +
  xlab("Proportion SNH") +
  ylab("crop-loss par crop infecté") +
  facet_grid(infection.rate ~ ., labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation faible : crop-loss normalisée (/ pests) \nYear = 5, nb init pred = 10")

plot3 <- tibble(proportion = rep(sort(unique(as.numeric(as.character(data.dyn.mean$proportion)))),length(unique(as.numeric(as.character(data.dyn.mean$infection.rate))))),
       stock.crops = round(1089 -(1089 * proportion/100),0),
       infection.rate = rep(sort(unique(as.numeric(as.character(data.dyn.mean$infection.rate)))),each = length(unique(as.numeric(as.character(data.dyn.mean$proportion))))),
       tot.crops.inf = ifelse ((150 * round(infection.rate/100*1089)) < stock.crops, (150 * round(infection.rate/100*1089)), stock.crops)) %>% 
  right_join(data.end.season.mean %>% 
               # normalisation crop-loss selon le nb. de crops
               mutate(stock.crops = 1089 - floor(1089*proportion/100)) %>% 
               mutate(norm.mean.lsc.tot.crop.loss = mean.lsc.tot.crop.loss/stock.crops) %>% 
               # filter
               filter(nb.init == 10) %>% 
               filter(year == 5) %>%
               # scenario agrégation forte
               filter(agregation == 5) %>%
               # scenario mortalité forte
               filter(mortality == 0.08) %>%
               ungroup() %>% 
               select(infection.rate, proportion, mean.lsc.tot.crop.loss) %>% 
               distinct(),
             by = c("proportion","infection.rate")) %>% 
  mutate(norm.mean.lsc.tot.crop.loss = mean.lsc.tot.crop.loss / tot.crops.inf) %>% 
  select(infection.rate, proportion, norm.mean.lsc.tot.crop.loss) %>% 
  ggplot() +
  geom_point(mapping = aes(x = as.factor(proportion), y = norm.mean.lsc.tot.crop.loss)) +
  xlab("Proportion SNH") +
  ylab("crop-loss par crop infecté") +
  facet_grid(infection.rate ~ ., labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation forte : crop-loss normalisée (/ pests) \nYear = 5, nb init pred = 10")

plot4 <- tibble(proportion = rep(sort(unique(as.numeric(as.character(data.dyn.mean$proportion)))),length(unique(as.numeric(as.character(data.dyn.mean$infection.rate))))),
       stock.crops = round(1089 -(1089 * proportion/100),0),
       infection.rate = rep(sort(unique(as.numeric(as.character(data.dyn.mean$infection.rate)))),each = length(unique(as.numeric(as.character(data.dyn.mean$proportion))))),
       tot.crops.inf = ifelse ((150 * round(infection.rate/100*1089)) < stock.crops, (150 * round(infection.rate/100*1089)), stock.crops)) %>% 
  right_join(data.end.season.mean %>% 
               # normalisation crop-loss selon le nb. de crops
               mutate(stock.crops = 1089 - floor(1089*proportion/100)) %>% 
               mutate(norm.mean.lsc.tot.crop.loss = mean.lsc.tot.crop.loss/stock.crops) %>% 
               # filter
               filter(nb.init == 10) %>% 
               filter(year == 5) %>%
               # scenario agrégation faible
               filter(agregation == 1) %>%
               # scenario mortalité forte
               filter(mortality == 0.08) %>%
               ungroup() %>% 
               select(infection.rate, proportion, mean.lsc.tot.crop.loss) %>% 
               distinct(),
             by = c("proportion","infection.rate")) %>% 
  mutate(norm.mean.lsc.tot.crop.loss = mean.lsc.tot.crop.loss / tot.crops.inf) %>% 
  select(infection.rate, proportion, norm.mean.lsc.tot.crop.loss) %>% 
  ggplot() +
  geom_point(mapping = aes(x = as.factor(proportion), y = norm.mean.lsc.tot.crop.loss)) +
  xlab("Proportion SNH") +
  ylab("crop-loss par crop infecté") +
  facet_grid(infection.rate ~ ., labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation faible : crop-loss normalisée (/ pests) \nYear = 5, nb init pred = 10")

multiplot(plot1, plot2, plot3, plot4, cols = 2)
```


## Distribution des valeurs de crop-loss

```{r crop.loss distribution}
plot1 <- data.spatial.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>%
  ggplot() +
  geom_boxplot(mapping = aes(x = factor(proportion), y = mean.tot.crop.loss)) +
  xlab("Proportion") +
  ylab("Distribution des valeurs de crop-loss") +
  facet_grid(infection.rate ~ ., labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation forte : distribution des crop-loss \nYear = 5, nb.init = 10")

plot2 <- data.spatial.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité faible
  filter(mortality == 0.01) %>%
  ggplot() +
  geom_boxplot(mapping = aes(x = factor(proportion), y = mean.tot.crop.loss)) +
  xlab("Proportion") +
  ylab("Distribution des valeurs de crop-loss") +
  facet_grid(infection.rate ~ ., labeller = label_both) +
  ggtitle("Mortalité faible / Agrégation faible : distribution des crop-loss \nYear = 5, nb.init = 10")

plot3 <- data.spatial.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation forte
  filter(agregation == 5) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>%
  ggplot() +
  geom_boxplot(mapping = aes(x = factor(proportion), y = mean.tot.crop.loss)) +
  xlab("Proportion") +
  ylab("Distribution des valeurs de crop-loss") +
  facet_grid(infection.rate ~ ., labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation forte : distribution des crop-loss \nYear = 5, nb.init = 10")

plot4 <- data.spatial.mean %>% 
  # filter
  filter(nb.init == 10) %>% 
  filter(year == 5) %>%
  # scenario agrégation faible
  filter(agregation == 1) %>%
  # scenario mortalité forte
  filter(mortality == 0.08) %>%
  ggplot() +
  geom_boxplot(mapping = aes(x = factor(proportion), y = mean.tot.crop.loss)) +
  xlab("Proportion") +
  ylab("Distribution des valeurs de crop-loss") +
  facet_grid(infection.rate ~ ., labeller = label_both) +
  ggtitle("Mortalité forte / Agrégation faible : distribution des crop-loss \nYear = 5, nb.init = 10")

multiplot(plot1, plot2, plot3, plot4, cols = 2)
```
